# -*- coding: utf-8 -*-
# Generated by Django 4.2.10 on 2024-05-10 15:30

from django.db import migrations, models


def migrate_organization_to_organizations(apps, schema_editor):
    Dataset = apps.get_model('v1', 'Dataset')
    for dataset in Dataset.objects.all():
        if dataset.organization:
            dataset.organizations.add(dataset.organization)


class Migration(migrations.Migration):
    dependencies = [
        ('v1', '0038_rename_level_area_administrative_level'),
    ]

    operations = [
        # Add new ManyToMany field
        migrations.AddField(
            model_name='dataset',
            name='organizations',
            field=models.ManyToManyField(
                related_name='datasets',
                to='v1.organization',
                verbose_name='Organizations',
                help_text='Organizations associated with this dataset',
            ),
        ),
        # Run data migration
        migrations.RunPython(
            migrate_organization_to_organizations,
            reverse_code=migrations.RunPython.noop
        ),
        # Remove old ForeignKey field
        migrations.RemoveField(
            model_name='dataset',
            name='organization',
        ),
    ]